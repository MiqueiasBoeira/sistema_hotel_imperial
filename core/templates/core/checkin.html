{% extends 'core/base.html' %}
{% load static %}
{% block title %}Check-in{% endblock %}

{% block content %}
<div class="checkin-container">
    <h1>Check-in</h1>
    <form method="post">
        {% csrf_token %}
        <label for="tipo_hospede">Tipo de Hóspede:</label>
        <select id="tipo_hospede" name="tipo_hospede" onchange="toggleHospedeFields()">
            <option value="individual">Individual</option>
            <option value="empresa">Empresa</option>
        </select>

        <div id="individual_fields" style="display:block;">
            <p></p>
            {{ form.hospede_principal.label_tag }} {{ form.hospede_principal }}
            <a href="{% url 'incluir_hospede_view' %}" class="btn">Registrar Hóspede</a>
            <p></p>
            <button type="button" onclick="addIndividualHospedeField()">Adicionar Hóspede Secundário</button>
            <div id="individual_hospede_fields"></div>
        </div>

        <div id="empresa_fields" style="display:none;">
            <p></p>
            {{ form.empresa.label_tag }} {{ form.empresa }}
            <a href="{% url 'incluir_empresa_view' %}" class="btn">Registrar Empresa</a>
            <p></p>
            <button type="button" onclick="addEmpresaHospedeField()">Adicionar hóspede</button>
            <a href="{% url 'incluir_hospede_view' %}" class="btn">Registrar Hóspede</a>
            <div id="empresa_hospede_fields"></div>
        </div>

        {{ form.as_p|safe }}

        <button type="submit">Registrar Check-in</button>
    </form>
</div>

{% block extra_script %}
<script src="{% static 'js/checkin.js' %}"></script>
<script>
function toggleHospedeFields() {
    const tipoHospede = document.getElementById('tipo_hospede').value;
    document.getElementById('individual_fields').style.display = tipoHospede === 'individual' ? 'block' : 'none';
    document.getElementById('empresa_fields').style.display = tipoHospede === 'empresa' ? 'block' : 'none';
}

function addIndividualHospedeField() {
    const hospedeFields = document.getElementById('individual_hospede_fields');
    const newField = document.createElement('div');
    newField.innerHTML = `
        <label for="hospede_secundario">Hóspede Secundário:</label>
        <select name="hospede_secundario">
            {% for hospede in hospedes %}
                <option value="{{ hospede.id }}">{{ hospede.nome_completo }}</option>
            {% endfor %}
        </select>
    `;
    hospedeFields.appendChild(newField);
}

function addEmpresaHospedeField() {
    const hospedeFields = document.getElementById('empresa_hospede_fields');
    const newField = document.createElement('div');
    newField.innerHTML = `
        <label for="hospede_empresa">Hóspede da Empresa:</label>
        <select name="hospede_empresa">
            {% for hospede in hospedes %}
                <option value="{{ hospede.id }}">{{ hospede.nome_completo }}</option>
            {% endfor %}
        </select>
    `;
    hospedeFields.appendChild(newField);
}
</script>
{% endblock %}
{% endblock %}
